# Загрузка изображений продуктов

## Обзор

Система загрузки изображений для продуктов позволяет администраторам загружать и управлять изображениями товаров через веб-интерфейс.

## Возможности

- **Множественная загрузка**: Загрузка нескольких изображений одновременно
- **Предпросмотр**: Мгновенный предпросмотр загруженных изображений
- **Удаление**: Возможность удаления отдельных изображений
- **Валидация**: Проверка типа и размера файлов
- **Автоматическое именование**: Уникальные имена файлов для избежания конфликтов

## Технические требования

### Поддерживаемые форматы
- PNG
- JPG/JPEG
- GIF

### Ограничения
- **Максимальный размер файла**: 10MB
- **Максимальное количество**: Без ограничений (рекомендуется до 10 изображений на продукт)

## Структура файлов

### Backend
```
backend/
├── uploads/
│   └── products/          # Папка для изображений продуктов
│       ├── product_20241201_143022_image1.jpg
│       ├── product_20241201_143022_image2.png
│       └── ...
```

### API Endpoints

#### Загрузка одного изображения
```
POST /api/v1/products/upload-image
Content-Type: multipart/form-data

file: [изображение]
```

**Ответ:**
```json
{
  "file_path": "uploads/products/product_20241201_143022_image.jpg",
  "filename": "product_20241201_143022_image.jpg",
  "url": "/uploads/products/product_20241201_143022_image.jpg"
}
```

#### Загрузка нескольких изображений
```
POST /api/v1/products/upload-multiple-images
Content-Type: multipart/form-data

files: [изображение1, изображение2, ...]
```

**Ответ:**
```json
{
  "uploaded_files": [
    {
      "file_path": "uploads/products/product_20241201_143022_image1.jpg",
      "filename": "product_20241201_143022_image1.jpg",
      "url": "/uploads/products/product_20241201_143022_image1.jpg"
    }
  ],
  "count": 1
}
```

## Использование в админке

### 1. Открытие формы продукта
- Перейдите в **Админка** → **Управление продуктами**
- Нажмите **Добавить продукт** или **Редактировать** существующий

### 2. Загрузка изображений
- В первом табе **"Основная информация"** найдите секцию **"Изображения продукта"**
- Нажмите **"Выбрать изображения"**
- Выберите один или несколько файлов изображений
- Дождитесь завершения загрузки

### 3. Управление изображениями
- **Просмотр**: Все загруженные изображения отображаются в виде миниатюр
- **Удаление**: Наведите курсор на изображение и нажмите красный крестик
- **Порядок**: Первое изображение автоматически становится основным

## Структура базы данных

### Таблица `products`
```sql
CREATE TABLE products (
    id INTEGER PRIMARY KEY,
    name VARCHAR(255),
    category VARCHAR(100),
    description TEXT,
    features TEXT,           -- JSON массив
    image_path VARCHAR(500), -- Основное изображение
    images TEXT,             -- JSON массив дополнительных изображений
    specifications TEXT,      -- JSON объект технических характеристик
    detailed TEXT,           -- JSON объект детальной информации
    price REAL,              -- Цена
    status VARCHAR(20),
    created_at DATETIME,
    updated_at DATETIME
);
```

### Пример данных изображений
```json
{
  "image_path": "/uploads/products/product_20241201_143022_main.jpg",
  "images": [
    "/uploads/products/product_20241201_143022_main.jpg",
    "/uploads/products/product_20241201_143022_detail1.jpg",
    "/uploads/products/product_20241201_143022_detail2.jpg"
  ]
}
```

## Безопасность

### Валидация файлов
- Проверка MIME-типа (только изображения)
- Проверка размера файла
- Автоматическое переименование для предотвращения конфликтов

### Ограничения доступа
- Загрузка доступна только авторизованным администраторам
- Файлы сохраняются в защищенной директории

## Миграция базы данных

Если у вас старая версия базы данных, выполните миграцию:

```bash
cd backend
python migrate_products.py
```

Этот скрипт:
- Добавит новые колонки в таблицу `products`
- Заполнит их значениями по умолчанию
- Сохранит существующие данные

## Устранение неполадок

### Ошибка "Файл должен быть изображением"
- Убедитесь, что файл имеет расширение .jpg, .png или .gif
- Проверьте, что файл не поврежден

### Ошибка "Размер файла не должен превышать 10MB"
- Сожмите изображение или используйте файл меньшего размера
- Рекомендуется использовать изображения до 2MB для быстрой загрузки

### Изображения не отображаются
- Проверьте, что сервер запущен
- Убедитесь, что папка `uploads/products` существует
- Проверьте права доступа к папке

### Ошибка загрузки
- Проверьте подключение к интернету
- Убедитесь, что сервер API доступен по адресу `http://localhost:8000`
- Проверьте логи сервера на наличие ошибок

## Рекомендации

### Оптимизация изображений
- **Размер**: Рекомендуется 800x600 пикселей для миниатюр
- **Формат**: Используйте JPEG для фотографий, PNG для изображений с прозрачностью
- **Сжатие**: Оптимизируйте изображения перед загрузкой

### Организация файлов
- Используйте описательные имена для изображений
- Группируйте изображения по продуктам
- Регулярно очищайте неиспользуемые файлы

### Резервное копирование
- Регулярно создавайте резервные копии папки `uploads`
- Включите изображения в общую стратегию резервного копирования

## Примеры использования

### JavaScript (загрузка через API)
```javascript
const formData = new FormData();
formData.append('files', fileInput.files[0]);

const response = await fetch('/api/v1/products/upload-image', {
    method: 'POST',
    body: formData
});

const result = await response.json();
console.log('Загружено:', result.url);
```

### React (использование в компоненте)
```jsx
const handleImageUpload = async (event) => {
    const files = event.target.files;
    const formData = new FormData();
    
    for (let i = 0; i < files.length; i++) {
        formData.append('files', files[i]);
    }

    try {
        const response = await fetch('/api/v1/products/upload-multiple-images', {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            const result = await response.json();
            setUploadedImages(prev => [...prev, ...result.uploaded_files.map(f => f.url)]);
        }
    } catch (error) {
        console.error('Ошибка загрузки:', error);
    }
};
```

## Поддержка

При возникновении проблем:
1. Проверьте логи сервера
2. Убедитесь в корректности настроек
3. Проверьте права доступа к файлам
4. Обратитесь к документации API

---

**Версия**: 1.0  
**Дата**: Декабрь 2024  
**Автор**: Inox Metal Art Development Team





